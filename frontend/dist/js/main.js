$(document).ready(function(){let e;if(!document.getElementById("jsonInput"))return;let t=!1,i=document.getElementById("jsonInput");function a(e){let t;try{let i="string"==typeof e?JSON.parse(e):e;t=JSON.stringify(i,null,2)}catch(i){t=e||""}i.textContent=t,Prism.highlightElement(i)}function n(e){try{let t;if(!e.trim())return{isValid:!1,error:"Input is empty"};try{t=JSON.parse(e)}catch(e){return{isValid:!1,error:"Invalid JSON format",details:e.message}}let i=[];if(t["@context"]?Array.isArray(t["@context"])?t["@context"].includes("https://www.w3.org/2018/credentials/v1")||i.push('@context must include "https://www.w3.org/2018/credentials/v1"'):i.push("@context must be an array"):i.push("Missing @context field"),t.type?Array.isArray(t.type)?(t.type.includes("VerifiableCredential")||i.push('type must include "VerifiableCredential"'),t.type.length<2&&i.push("type should include at least one specific credential type")):i.push("type must be an array"):i.push("Missing type field"),t.issuer?"object"!=typeof t.issuer&&"string"!=typeof t.issuer?i.push("issuer must be an object or string"):"object"!=typeof t.issuer||t.issuer.id||i.push("issuer object must have an id field"):i.push("Missing issuer field"),t.issuanceDate)try{new Date(t.issuanceDate).toISOString()}catch(e){i.push("issuanceDate must be a valid ISO 8601 date")}else i.push("Missing issuanceDate field");if(t.credentialSubject?"object"!=typeof t.credentialSubject&&i.push("credentialSubject must be an object"):i.push("Missing credentialSubject field"),i.length>0)return{isValid:!1,error:"Invalid Verifiable Credential",details:i};return{isValid:!0,details:[`Valid credential type: ${t.type[t.type.length-1]}`,`Issued by: ${"string"==typeof t.issuer?t.issuer:t.issuer.name||t.issuer.id}`,`Issued on: ${new Date(t.issuanceDate).toLocaleDateString()}`]}}catch(e){return{isValid:!1,error:"Validation error",details:e.message}}}function r(e,t=!1){let i=$(".validation-feedback");if(i.removeClass("is-valid is-invalid show"),t){if(i.addClass("show"),e.isValid)i.addClass("is-valid");else if(i.addClass("is-invalid"),e.details){let t=Array.isArray(e.details)?`<ul class="validation-details">
                        ${e.details.map(e=>`<li>${e}</li>`).join("")}
                       </ul>`:`<div class="mt-1">${e.details}</div>`;$(".invalid-feedback").html(`
                    <i class="fas fa-exclamation-circle"></i>
                    <div>
                        <strong>${e.error}</strong>
                        ${t}
                    </div>
                `)}}}function l(e){let t=$("#themeSelect");t.empty();let i=BaseTheme.getThemesByType(e);i&&i.length>0?(i.forEach(i=>{let a=`${e}:${i.id}`;t.append(`<option value="${a}">${i.name}</option>`)}),t.val(`${e}:${i[0].id}`)):t.append('<option value="" disabled>No themes available</option>')}function d(){let e=i.textContent.trim();if(!e){r({isValid:!1,error:"Input is empty"},!0),document.getElementById("previewContainer").innerHTML="";return}try{let t=JSON.parse(e),i=n(e);if(r(i,!0),!i.isValid){document.getElementById("previewContainer").innerHTML="";return}let a=document.getElementById("previewContainer");a.innerHTML="";let d=t.type[t.type.length-1];window.logger.debug(`Getting themes for credential type: ${d}`);let s=new URLSearchParams(window.location.search).get("theme");0===$("#themeSelect option").length&&(l(d),s&&$("#themeSelect").val(s));let o=BaseTheme.getThemesByType(d);if(!o||0===o.length){r({isValid:!1,error:"Theme Error",details:`No theme found for credential type: ${d}`},!0);return}let c=s||$("#themeSelect").val()||`${d}:${o[0].id}`,p=BaseTheme.getTheme(c);if(!p){r({isValid:!1,error:"Theme Error",details:`Selected theme not found: ${c}`},!0);return}try{let e=new p(t).render();e&&e instanceof Element?(a.innerHTML="",a.appendChild(e)):(console.error("Theme render() did not return a valid Element"),a.innerHTML='<div class="alert alert-danger">Error rendering credential</div>')}catch(e){console.error("Error rendering theme:",e),a.innerHTML='<div class="alert alert-danger">Error rendering credential</div>'}}catch(e){r({isValid:!1,error:"Invalid JSON format",details:e.message},!0),document.getElementById("previewContainer").innerHTML=""}}function s(e){return logger.debug("Getting themes for credential type:",e),BaseTheme.getThemesByType(e)}function o(e){let t=$("#themeSelect"),i=$(".theme-info");if(t.empty().append('<option value="">Select a theme...</option>'),!e||!e.type){t.prop("disabled",!0),i.addClass("d-none");return}let a=e.type[e.type.length-1],n=s(a);if(n.length>0)n.forEach(e=>{let i=`${a}:${e.id}`;t.append(`<option value="${i}">${e.name}</option>`)}),t.prop("disabled",!1),c(n[0]),i.removeClass("d-none"),t.val(`${a}:${n[0].id}`);else{let e=s("VerifiableCredential");e.length>0?(e.forEach(e=>{let i=`VerifiableCredential:${e.id}`;t.append(`<option value="${i}">${e.name}</option>`)}),t.prop("disabled",!1),c(e[0]),i.removeClass("d-none"),t.val(`VerifiableCredential:${e[0].id}`)):(t.prop("disabled",!0),i.addClass("d-none"))}}function c(e){e&&$(".theme-info").removeClass("d-none").find(".theme-name").text(e.name).end().find(".theme-description").text(e.description).end().find(".theme-author").text(`Created by ${e.author}`)}function p(e){let t=`
            <div class="alert alert-danger alert-dismissible fade show" role="alert">
                ${e}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        `;$("#previewContainer").prepend(t),$("#outputCard").removeClass("d-none")}window.logger={info:(e,t)=>{let i=new Date().toISOString();console.log(`[${i}] INFO: ${e}`,t||"")},error:(e,t)=>{let i=new Date().toISOString();console.error(`[${i}] ERROR: ${e}`,t||"")},debug:(e,t)=>{let i=new Date().toISOString();console.debug(`[${i}] DEBUG: ${e}`,t||"")}},setTimeout(function(){let e=new URLSearchParams(window.location.search).get("theme");if(e){let[i,s]=e.split(":");if(window.examples[i]){t=!0;let s=window.examples[i];a(s);let o=n(JSON.stringify(s));r(o,!0),o.isValid&&(l(i),$("#themeSelect").val(e),d())}}},100),i.addEventListener("input",function(){t=!0,clearTimeout(e),e=setTimeout(()=>{let e=i.textContent.trim();if(t){let t=n(e);r(t,!0),t.isValid?d():document.getElementById("previewContainer").innerHTML=""}},500)}),$(".validation-feedback").length||$(".card").after(`
            <div class="validation-feedback">
                <div class="valid-feedback">
                    <i class="fas fa-check-circle"></i>
                    <div>
                        <strong>Valid Verifiable Credential</strong>
                    </div>
                </div>
                <div class="invalid-feedback"></div>
            </div>
        `),$("<style>").text(`
            .editor-container { position: relative; }
            .validation-feedback {
                padding: 0.75rem;
                border-radius: 0.5rem;
                margin-top: 1.5rem;
                background: white;
                box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
                display: none;
            }
            .validation-feedback.show {
                display: block;
            }
            .validation-feedback i {
                margin-right: 0.5rem;
                font-size: 1.1em;
            }
            .validation-details {
                padding-left: 1.5rem;
                margin-top: 0.5rem;
                font-size: 0.9em;
            }
            .validation-feedback.is-valid .valid-feedback { display: flex !important; }
            .validation-feedback.is-valid .invalid-feedback { display: none !important; }
            .validation-feedback.is-invalid .valid-feedback { display: none !important; }
            .validation-feedback.is-invalid .invalid-feedback { display: flex !important; }
        `).appendTo("head"),$("#universityExample").on("click",function(){t=!0;let e=window.examples.UniversityDegreeCredential;a(e);let i=n(JSON.stringify(e));r(i,!0),i.isValid&&(o(e),d())}),$("#driverLicenseExample").on("click",function(){t=!0;let e=window.examples.BelgianDriverLicenseCredential;a(e);let i=n(JSON.stringify(e));r(i,!0),i.isValid&&(o(e),d())}),i.addEventListener("paste",function(e){e.preventDefault(),a(e.clipboardData.getData("text"))}),$("#themeSelect").change(function(){d()}),$("#loadUniversityExample").click(function(){logger.debug("Loading university degree example");let e=examples.UniversityDegreeCredential;if(e){a(e);let t=n(JSON.stringify(e));r(t),t.isValid&&(o(e),d())}else logger.error("University degree example not found"),p("Failed to load university degree example")}),$("#loadDriverLicenseExample").click(function(){logger.debug("Loading driver license example");let e=examples.BelgianDriverLicenseCredential;if(e){a(e);let t=n(JSON.stringify(e));r(t),t.isValid&&(o(e),d())}else logger.error("Driver license example not found"),p("Failed to load driver license example")}),$("#exportImage").click(async function(){let e=$("#previewContainer").children().first();if(0===e.length){p("No credential to export. Please input a valid credential first.");return}try{let t=$(this),i=t.html();t.prop("disabled",!0).html('<i class="fas fa-spinner fa-spin"></i> Exporting...');let a=await html2canvas(e[0],{scale:2,backgroundColor:"#ffffff",logging:!1,useCORS:!0,allowTaint:!0}),n=document.createElement("a");n.download="credential.png",n.href=a.toDataURL("image/png"),n.click(),t.prop("disabled",!1).html(i),logger.info("Credential exported as image")}catch(e){logger.error("Error exporting credential as image:",e),p("Failed to export image. Please try again."),$(this).prop("disabled",!1).html(originalText)}}),$("#exportPDF").click(async function(){let e=$("#previewContainer").children().first();if(0===e.length){p("No credential to export. Please input a valid credential first.");return}try{let t=$(this),i=t.html();t.prop("disabled",!0).html('<i class="fas fa-spinner fa-spin"></i> Exporting...');let a=await html2canvas(e[0],{scale:2,backgroundColor:"#ffffff",logging:!1,useCORS:!0,allowTaint:!0}),{jsPDF:n}=window.jspdf,r=new n({orientation:"portrait",unit:"mm",format:"a4"}),l=a.toDataURL("image/png"),d=r.internal.pageSize.getWidth(),s=r.internal.pageSize.getHeight(),o=a.width,c=a.height,p=o/c,m=d-40,g=m/p;g>s-40&&(m=(g=s-40)*p);let f=(d-m)/2,u=(s-g)/2;r.addImage(l,"PNG",f,u,m,g),r.save("credential.pdf"),t.prop("disabled",!1).html(i),logger.info("Credential exported as PDF")}catch(e){logger.error("Error exporting credential as PDF:",e),p("Failed to export PDF. Please try again."),$(this).prop("disabled",!1).html(originalText)}}),$(".validation-feedback").removeClass("show")});
//# sourceMappingURL=main.js.map
